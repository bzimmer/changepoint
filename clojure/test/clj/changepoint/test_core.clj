(ns changepoint.test_core
  (:use
    [clojure test])
  (:require
    [changepoint.core :as p]))

(def small [10.7 13.0 11.4 11.5 12.5 14.1 14.8 14.1 12.6 16.0 11.7 10.6 10.0 11.4
  7.9 9.5 8.0 11.8 10.5 11.2 9.2 10.1 10.4 10.5])

(def big [8.0 31.0 27.0 33.0 15.0 25.0 45.0 21.0 31.0 6.0 22.0 20.0 13.0 23.0
  30.0 6.0 14.0 15.0 153.0 35.0 21.0 33.0 8.0 43.0 39.0 51.0 43.0 27.0 13.0 30.0
  90.0 59.0 43.0 46.0 49.0 119.0 79.0 35.0 18.0 65.0 61.0 55.0 48.0 16.0 35.0 28.0
  21.0 20.0 33.0 23.0 22.0 27.0 12.0 26.0 29.0 26.0 11.0 10.0 25.0 25.0 14.0 18.0
  29.0 11.0 25.0 41.0 29.0 18.0 33.0 39.0 17.0 6.0 17.0 16.0 14.0 56.0 18.0 21.0
  11.0 32.0 28.0 25.0 34.0 21.0 9.0 14.0 27.0 20.0 79.0 23.0 25.0 10.0 46.0 59.0
  34.0 18.0 17.0 28.0 11.0 26.0 19.0 17.0 23.0 24.0 20.0 15.0 6.0 20.0 40.0 52.0
  16.0 47.0 14.0 15.0 18.0 37.0 28.0 11.0 13.0 41.0 38.0 31.0 31.0 86.0 58.0 81.0
  54.0 66.0 77.0 114.0 85.0 99.0 64.0 69.0 73.0 63.0 82.0 65.0 77.0 55.0 50.0 71.0
  47.0 48.0 40.0 22.0 39.0 26.0 47.0 70.0 36.0 42.0 38.0 65.0 37.0 57.0 77.0 66.0
  42.0 48.0 34.0 49.0 47.0 50.0 53.0 73.0 54.0 41.0 50.0 41.0 106.0 51.0 37.0 33.0
  30.0 27.0 40.0 33.0 42.0 46.0 31.0 27.0 26.0 43.0 37.0 61.0 44.0 39.0 39.0 33.0
  38.0 100.0 64.0 55.0 46.0 36.0 25.0 33.0 42.0 39.0 63.0 71.0 60.0 22.0 45.0 59.0
  43.0 37.0 48.0 32.0 37.0 38.0 41.0 48.0 45.0 34.0 36.0 22.0 39.0 36.0 36.0 32.0
  45.0 38.0 55.0 39.0 55.0 52.0 35.0 70.0 30.0 53.0 48.0 46.0 44.0 50.0 28.0 45.0
  35.0 39.0 64.0 64.0 23.0 63.0 70.0 38.0 30.0 35.0 26.0 49.0 102.0 151.0 74.0 310.0
  24.0 21.0 24.0 21.0 19.0 25.0 8.0 105.0 34.0 20.0 119.0 36.0 16.0 50.0 49.0 45.0
  44.0 24.0 32.0 79.0 39.0 51.0 23.0 23.0 60.0 15.0 24.0 14.0 33.0 37.0 30.0 57.0
  17.0 24.0 21.0 32.0 23.0 22.0 27.0 21.0 34.0 28.0 38.0 48.0 39.0 26.0 11.0 24.0
  11.0 31.0 20.0 28.0 25.0 54.0 11.0 35.0 32.0 21.0 26.0 42.0 33.0 22.0 22.0 51.0
  27.0 20.0 34.0 27.0 20.0 59.0 34.0 47.0 22.0 29.0 32.0 74.0 55.0 63.0 26.0 14.0
  12.0 26.0 16.0 8.0 28.0 8.0 20.0 23.0 12.0 14.0 19.0 86.0 20.0 31.0 22.0 45.0 10.0
  15.0 25.0 17.0 8.0 30.0 29.0 23.0 14.0 17.0 28.0 23.0 40.0 12.0 19.0 16.0 24.0
  23.0 47.0 64.0 33.0 17.0 31.0 38.0 42.0 45.0 31.0 28.0 15.0 33.0 48.0 45.0 17.0
  58.0 54.0 15.0 32.0 36.0 32.0 47.0 43.0 30.0 37.0 40.0 31.0 38.0 30.0 26.0 16.0
  33.0 50.0 33.0 86.0 34.0 26.0 22.0 44.0 30.0 20.0 53.0 28.0 52.0 31.0 31.0 26.0
  14.0 34.0 28.0 29.0 70.0 19.0 32.0 22.0 36.0 33.0 10.0 30.0 35.0 15.0 38.0 28.0
  27.0 22.0 13.0 16.0 18.0 18.0 12.0 20.0 25.0 14.0 14.0 20.0 20.0 13.0 14.0 17.0
  19.0 20.0 16.0 15.0 25.0 11.0 29.0 16.0 15.0 10.0 12.0 13.0 18.0 13.0 10.0 11.0])

(deftest test-changepoint
  (testing "test changepoint detection (clojure)"
    (let [q (p/changepoint-seq small 0.99 1000)]
      (is (= #{11} q))))
  (testing "test changepoint detection (java wrapper)"
    (let [q (p/changepoint big 0.99 1000)]
      (is (= #{0 254 276 424} q)))))
